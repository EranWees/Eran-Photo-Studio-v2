<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eran Photo Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #09090b; /* Zinc 950 */
        color: #e4e4e7; /* Zinc 200 */
      }
      /* Custom scrollbar for sleek look */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #18181b;
      }
      ::-webkit-scrollbar-thumb {
        background: #3f3f46;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #52525b;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0",
    "react-dom/client": "https://aistudiocdn.com/react-dom@^19.2.0/client",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>
    <script type="module">
      import React, { useState, useRef, useEffect } from 'react';
      import ReactDOM from 'react-dom/client';
      import { GoogleGenAI, Modality } from "@google/genai";
      import { Upload, Image as ImageIcon, Wand2, Download, RefreshCw, Camera, Sparkles, ArrowRight, Layers, UserX, Check, ArrowLeft, Eraser, Paintbrush, BoxSelect, Aperture, ChevronRight } from 'lucide-react';

      // --- Application Constants & Types ---
      const AppStep = {
        HOME: 'HOME',
        WORKFLOW_SELECT: 'WORKFLOW_SELECT',
        UPLOAD: 'UPLOAD',
        ANALYZING: 'ANALYZING',
        GENERATING: 'GENERATING',
        RESULTS: 'RESULTS',
        DETAIL_VIEW: 'DETAIL_VIEW',
        MASKING: 'MASKING',
        REPLACE_OPTIONS: 'REPLACE_OPTIONS',
      };

      // --- Gemini Service ---
      const apiKey = process.env.API_KEY;
      const ai = new GoogleGenAI({ apiKey: apiKey });
      
      const generateEditedImage = async (base64Data, mimeType, style) => {
        try {
          const modelId = "gemini-2.5-flash-image";
          const prompt = `Edit this image to apply the following style: "${style.title}". Detailed instructions: ${style.description}. Ensure the output is a high-quality photograph preserving the main subject composition.`;
          const response = await ai.models.generateContent({
            model: modelId,
            contents: { parts: [{ inlineData: { mimeType: mimeType, data: base64Data } }, { text: prompt }] },
            config: { responseModalities: [Modality.IMAGE] },
          });
          const part = response.candidates?.[0]?.content?.parts?.[0];
          if (part && part.inlineData && part.inlineData.data) {
            return part.inlineData.data;
          }
          throw new Error("No image generated.");
        } catch (error) {
          console.error("Error generating edit:", error);
          throw error;
        }
      };

      const replaceObject = async (originalBase64, maskBase64, promptText) => {
        try {
          const modelId = "gemini-2.5-flash-image";
          const prompt = `Use the provided black and white mask image to identify the area to edit in the original image. Replace the masked area (white area in the mask) with: "${promptText}". Blend the new object seamlessly into the original environment, matching lighting, shadows, and perspective.`;
          const response = await ai.models.generateContent({
            model: modelId,
            contents: { parts: [{ inlineData: { mimeType: "image/png", data: originalBase64 } }, { inlineData: { mimeType: "image/png", data: maskBase64 } }, { text: prompt }] },
            config: { responseModalities: [Modality.IMAGE] },
          });
          const part = response.candidates?.[0]?.content?.parts?.[0];
          if (part && part.inlineData && part.inlineData.data) {
            return part.inlineData.data;
          }
          throw new Error("No image generated.");
        } catch (error) {
          console.error("Error replacing object:", error);
          throw error;
        }
      };
      
      // --- Components ---
      const Spinner = ({ className = "" }) => (
        React.createElement('svg', {
          className: `animate-spin ${className}`,
          xmlns: "http://www.w3.org/2000/svg",
          fill: "none",
          viewBox: "0 0 24 24"
        },
        React.createElement('circle', {
          className: "opacity-25",
          cx: "12",
          cy: "12",
          r: "10",
          stroke: "currentColor",
          strokeWidth: "4"
        }),
        React.createElement('path', {
          className: "opacity-75",
          fill: "currentColor",
          d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
        }))
      );

      // --- Main App Component ---
      const App = () => {
        const [step, setStep] = useState(AppStep.HOME);
        const [imageState, setImageState] = useState({ original: null, mimeType: '' });
        const [selectedSuggestion, setSelectedSuggestion] = useState(null);
        const [results, setResults] = useState([]);
        const [selectedImage, setSelectedImage] = useState(null);
        const [error, setError] = useState(null);
        const [isRefining, setIsRefining] = useState(false);
        
        // Masking State
        const [brushSize, setBrushSize] = useState(30);
        const isDrawingRef = useRef(false);
        const [maskData, setMaskData] = useState(null);
        const [customReplacePrompt, setCustomReplacePrompt] = useState("");

        const fileInputRef = useRef(null);
        const backgroundCanvasRef = useRef(null);
        const drawCanvasRef = useRef(null);

        const MODES = [
          { title: "Clean Studio Backdrop", description: "Isolate your subject on a clean, professional background. Removes distractions while enhancing studio lighting." },
          { title: "Replace Object", description: "Select specific objects in your photo to replace with new props, furniture, or elements using AI inpainting." }
        ];

        const handleFileUpload = (event) => {
          const file = event.target.files?.[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onloadend = async () => {
            const base64String = reader.result;
            const matches = base64String.match(/^data:(.+);base64,(.+)$/);
            if (matches && matches.length === 3) {
              const mimeType = matches[1];
              const data = matches[2];
              setImageState({ original: data, mimeType });
              if (selectedSuggestion?.title === "Replace Object") {
                setStep(AppStep.MASKING);
              } else if (selectedSuggestion) {
                triggerGeneration(data, mimeType, selectedSuggestion);
              }
            }
          };
          reader.readAsDataURL(file);
        };

        const handleModeSelect = (mode) => {
          setSelectedSuggestion(mode);
          setStep(AppStep.UPLOAD);
        };

        const triggerGeneration = async (base64, mimeType, style) => {
          setStep(AppStep.GENERATING);
          setResults([]);
          try {
            const promises = Array(4).fill(null).map((_, index) =>
              generateEditedImage(base64, mimeType, style).then(data => ({ id: `gen-${Date.now()}-${index}`, data }))
            );
            const images = await Promise.all(promises);
            setResults(images);
            setStep(AppStep.RESULTS);
          } catch (e) {
            console.error(e);
            setError("Failed to generate edits. Please try again.");
            setStep(AppStep.UPLOAD);
          }
        };

        const handleImageSelect = (img) => {
          setSelectedImage(img);
          setStep(AppStep.DETAIL_VIEW);
        };

        const handleRemoveSubject = async () => {
          if (!selectedImage) return;
          setIsRefining(true);
          try {
            const removeSubjectStyle = { title: "Remove Subject", description: "Remove the main person or subject from the image completely. Keep the background exactly as is, filling in the empty space naturally using inpainting." };
            const newImageData = await generateEditedImage(selectedImage.data, "image/png", removeSubjectStyle);
            setSelectedImage({ id: `refined-${Date.now()}`, data: newImageData });
          } catch (e) {
            console.error(e);
            setError("Failed to remove subject.");
          } finally {
            setIsRefining(false);
          }
        };

        // --- Masking Logic ---
        const initMasking = () => {
          if (step === AppStep.MASKING && backgroundCanvasRef.current && drawCanvasRef.current && imageState.original) {
            const bgCanvas = backgroundCanvasRef.current;
            const bgCtx = bgCanvas.getContext('2d');
            const drawCanvas = drawCanvasRef.current;
            const drawCtx = drawCanvas.getContext('2d');
            const img = new Image();
            img.src = `data:${imageState.mimeType};base64,${imageState.original}`;
            img.onload = () => {
              bgCanvas.width = img.width;
              bgCanvas.height = img.height;
              drawCanvas.width = img.width;
              drawCanvas.height = img.height;
              if (bgCtx) bgCtx.drawImage(img, 0, 0);
              if (drawCtx) {
                drawCtx.clearRect(0, 0, drawCanvas.width, drawCanvas.height);
                drawCtx.lineCap = 'round';
                drawCtx.lineJoin = 'round';
                drawCtx.strokeStyle = 'rgba(255, 0, 0, 0.5)';
                drawCtx.lineWidth = brushSize;
              }
            };
          }
        };

        useEffect(initMasking, [step, imageState.original]);
        useEffect(() => {
          if (drawCanvasRef.current) {
            const ctx = drawCanvasRef.current.getContext('2d');
            if (ctx) ctx.lineWidth = brushSize;
          }
        }, [brushSize]);

        const getCoordinates = (e, canvas) => {
            const rect = canvas.getBoundingClientRect();
            let clientX, clientY;
            if ('touches' in e) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY };
        };

        const startDrawing = (e) => {
          e.preventDefault();
          isDrawingRef.current = true;
          const canvas = drawCanvasRef.current;
          const ctx = canvas?.getContext('2d');
          if (!ctx || !canvas) return;
          const { x, y } = getCoordinates(e, canvas);
          ctx.beginPath();
          ctx.moveTo(x, y);
          ctx.lineTo(x, y);
          ctx.stroke();
          // Start path for next segment
          ctx.beginPath();
          ctx.moveTo(x, y);
        };

        const stopDrawing = () => {
          isDrawingRef.current = false;
          drawCanvasRef.current?.getContext('2d')?.beginPath();
        };

        const drawOnLayer = (e) => {
          e.preventDefault();
          if (!isDrawingRef.current || !drawCanvasRef.current) return;
          const canvas = drawCanvasRef.current;
          const ctx = canvas.getContext('2d');
          if (!ctx) return;
          const { x, y } = getCoordinates(e, canvas);
          // Draw segment
          ctx.lineTo(x, y);
          ctx.stroke();
          // Begin new path at current point for next segment (performance optimization)
          ctx.beginPath();
          ctx.moveTo(x, y);
        };

        const generateMaskAndProceed = () => {
          if (!drawCanvasRef.current) return;
          const sourceCanvas = drawCanvasRef.current;
          const tempCanvas = document.createElement('canvas');
          tempCanvas.width = sourceCanvas.width;
          tempCanvas.height = sourceCanvas.height;
          const ctx = tempCanvas.getContext('2d');
          if (!ctx) return;
          
          // Create mask: black background, white drawing
          ctx.fillStyle = 'black';
          ctx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
          ctx.globalCompositeOperation = 'source-over';
          ctx.drawImage(sourceCanvas, 0, 0);
          
          // Convert drawing (red) to white
          const imageData = ctx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
          const data = imageData.data;
          for (let i = 0; i < data.length; i += 4) {
            // If pixel has any color/alpha, make it white
            if (data[i] > 0 || data[i + 1] > 0 || data[i + 2] > 0) {
              data[i] = 255; data[i + 1] = 255; data[i + 2] = 255; data[i + 3] = 255;
            }
          }
          ctx.putImageData(imageData, 0, 0);
          const maskBase64 = tempCanvas.toDataURL('image/png').split(',')[1];
          setMaskData(maskBase64);
          setStep(AppStep.REPLACE_OPTIONS);
        };

        const executeReplacement = async (promptText) => {
          if (!imageState.original || !maskData) return;
          setStep(AppStep.GENERATING);
          setResults([]);
          try {
            const promises = Array(4).fill(null).map((_, index) =>
              replaceObject(imageState.original, maskData, promptText).then(data => ({ id: `rep-${Date.now()}-${index}`, data }))
            );
            const images = await Promise.all(promises);
            setResults(images);
            setStep(AppStep.RESULTS);
          } catch (e) {
            console.error(e);
            setError("Failed to replace object.");
            setStep(AppStep.REPLACE_OPTIONS);
          }
        };

        const handleReset = () => {
          setStep(AppStep.HOME);
          setImageState({ original: null, mimeType: '' });
          setResults([]);
          setSelectedSuggestion(null);
          setSelectedImage(null);
          setError(null);
          setIsRefining(false);
          setMaskData(null);
          setCustomReplacePrompt("");
        };

        const downloadImage = (base64) => {
          const link = document.createElement('a');
          link.href = `data:image/png;base64,${base64}`;
          link.download = `eran-studio-edit-${Date.now()}.png`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        };
        
        // --- View Renderers ---

        const renderHeader = () => React.createElement('header', { className: "w-full p-6 flex items-center justify-between border-b border-zinc-800 bg-zinc-900/50 backdrop-blur-md sticky top-0 z-50" },
          React.createElement('div', { className: "flex items-center gap-2 cursor-pointer", onClick: () => setStep(AppStep.HOME) },
            React.createElement('div', { className: "w-8 h-8 bg-white rounded-lg flex items-center justify-center" }, React.createElement(Camera, { className: "w-5 h-5 text-black" })),
            React.createElement('h1', { className: "text-xl font-bold text-white tracking-tight" }, "Eran Photo Studio")
          ),
          step !== AppStep.HOME && React.createElement('button', { onClick: handleReset, className: "text-sm text-zinc-400 hover:text-white flex items-center gap-2 transition-colors" },
            React.createElement(RefreshCw, { className: "w-4 h-4" }), " Restart"
          )
        );

        const renderHome = () => React.createElement('div', { className: "flex-1 flex flex-col relative animate-fade-in overflow-hidden" },
            React.createElement('div', { className: "absolute inset-0 z-0" },
                React.createElement('img', { src: "https://images.unsplash.com/photo-1542038784456-1ea8e935640e?q=80&w=2670&auto=format&fit=crop", alt: "Studio Background", className: "w-full h-full object-cover opacity-30 scale-105 animate-[pulse_10s_infinite]" }),
                React.createElement('div', { className: "absolute inset-0 bg-gradient-to-t from-zinc-950 via-zinc-950/80 to-transparent" })
            ),
            React.createElement('div', { className: "relative z-10 flex-1 flex flex-col items-center justify-center p-8" },
                React.createElement('div', { className: "max-w-5xl w-full text-center space-y-8" },
                    React.createElement('h1', { className: "text-6xl md:text-8xl font-black text-transparent bg-clip-text bg-gradient-to-b from-white to-zinc-500 tracking-tighter drop-shadow-2xl" }, "Eran Photo Studio"),
                    React.createElement('p', { className: "text-2xl text-zinc-300 font-light tracking-wide" }, "Professional AI Photography Suite"),
                    React.createElement('div', { className: "pt-8" },
                        React.createElement('button', { onClick: () => setStep(AppStep.WORKFLOW_SELECT), className: "group relative px-8 py-4 bg-white text-black text-lg font-bold rounded-full overflow-hidden transition-all hover:scale-105 hover:shadow-[0_0_40px_rgba(255,255,255,0.3)]" },
                            React.createElement('span', { className: "relative z-10 flex items-center gap-2" }, "Enter Studio ", React.createElement(ArrowRight, { className: "w-5 h-5 group-hover:translate-x-1 transition-transform" })),
                            React.createElement('div', { className: "absolute inset-0 bg-zinc-200 translate-y-full group-hover:translate-y-0 transition-transform duration-300" })
                        )
                    )
                )
            ),
            React.createElement('div', { className: "relative z-10 p-6 text-center text-zinc-600 text-sm" }, "Powered by Gemini 2.5 Flash Image")
        );
        
        const renderWorkflowSelect = () => React.createElement('div', {className: "flex-1 flex flex-col items-center justify-center p-8 animate-fade-in bg-zinc-950"},
            React.createElement('div', {className: "max-w-4xl w-full space-y-10"},
                React.createElement('div', {className: "text-center space-y-2"},
                    React.createElement('h2', {className: "text-4xl font-bold text-white"}, "Select Workflow"),
                    React.createElement('p', {className: "text-zinc-400"}, "Choose how you want to edit your photography.")
                ),
                React.createElement('div', {className: "grid grid-cols-1 md:grid-cols-2 gap-8"},
                    React.createElement('button', {onClick: () => handleModeSelect(MODES[0]), className: "group flex flex-col bg-zinc-900 border border-zinc-800 rounded-3xl p-1 transition-all hover:border-blue-500/50 hover:bg-zinc-900/80"},
                        React.createElement('div', {className: "h-48 w-full bg-zinc-950 rounded-t-[20px] rounded-b-lg relative overflow-hidden flex items-center justify-center group-hover:bg-blue-950/20 transition-colors"}, 
                          React.createElement(Layers, { className: "w-16 h-16 text-zinc-700 group-hover:text-blue-400 transition-colors duration-500" }),
                          React.createElement('div', { className: "absolute inset-0 bg-gradient-to-t from-zinc-900 via-transparent to-transparent opacity-50" })
                        ),
                        React.createElement('div', {className: "p-6 text-left space-y-2"},
                            React.createElement('h3', {className: "text-xl font-bold text-white group-hover:text-blue-400 transition-colors"}, "Clean Studio Backdrop"),
                            React.createElement('p', {className: "text-sm text-zinc-400 leading-relaxed"}, "Automatically remove clutter and place your subject in a pristine studio environment.")
                        )
                    ),
                    React.createElement('button', {onClick: () => handleModeSelect(MODES[1]), className: "group flex flex-col bg-zinc-900 border border-zinc-800 rounded-3xl p-1 transition-all hover:border-purple-500/50 hover:bg-zinc-900/80"},
                        React.createElement('div', {className: "h-48 w-full bg-zinc-950 rounded-t-[20px] rounded-b-lg relative overflow-hidden flex items-center justify-center group-hover:bg-purple-950/20 transition-colors"},
                          React.createElement(BoxSelect, { className: "w-16 h-16 text-zinc-700 group-hover:text-purple-400 transition-colors duration-500" }),
                          React.createElement('div', { className: "absolute inset-0 bg-gradient-to-t from-zinc-900 via-transparent to-transparent opacity-50" })
                        ),
                        React.createElement('div', {className: "p-6 text-left space-y-2"},
                            React.createElement('h3', {className: "text-xl font-bold text-white group-hover:text-purple-400 transition-colors"}, "Replace Object"),
                            React.createElement('p', {className: "text-sm text-zinc-400 leading-relaxed"}, "Use AI to paint over objects and replace them with props, furniture, or new elements.")
                        )
                    )
                ),
                React.createElement('div', {className: "flex justify-center"},
                  React.createElement('button', {onClick: () => setStep(AppStep.HOME), className: "text-zinc-500 hover:text-zinc-300 text-sm flex items-center gap-2"},
                      React.createElement(ArrowLeft, { className: "w-4 h-4" }), " Back to Entrance"
                  )
                )
            )
        );

        const renderUpload = () => React.createElement('div', { className: "flex flex-col items-center justify-center flex-1 p-8 animate-fade-in" },
            React.createElement('button', { onClick: () => setStep(AppStep.WORKFLOW_SELECT), className: "absolute top-24 left-8 flex items-center gap-2 text-zinc-500 hover:text-white transition-colors" }, React.createElement(ArrowLeft, { className: "w-4 h-4" }), " Change Workflow"),
            React.createElement('div', { className: "max-w-xl w-full text-center space-y-8" },
                React.createElement('div', { className: "space-y-2" },
                    React.createElement('div', { className: "inline-flex items-center gap-2 px-3 py-1 rounded-full bg-zinc-900 border border-zinc-800 text-zinc-400 text-xs uppercase tracking-widest mb-4" }, `Current Mode: ${selectedSuggestion?.title}`),
                    React.createElement('h2', { className: "text-4xl font-bold tracking-tight text-white" }, "Upload your photo"),
                    React.createElement('p', { className: "text-zinc-400 text-lg" }, "We'll apply your selected edit automatically.")
                ),
                React.createElement('div', { className: "relative group cursor-pointer", onClick: () => fileInputRef.current?.click() },
                    React.createElement('div', { className: "absolute -inset-0.5 bg-gradient-to-r from-zinc-500 to-white rounded-2xl blur opacity-20 group-hover:opacity-50 transition duration-1000 group-hover:duration-200" }),
                    React.createElement('div', { className: "relative w-full h-64 bg-zinc-900 rounded-2xl border-2 border-dashed border-zinc-700 group-hover:border-zinc-500 flex flex-col items-center justify-center gap-4 transition-all" },
                        React.createElement('div', { className: "w-16 h-16 rounded-full bg-zinc-800 flex items-center justify-center group-hover:scale-110 transition-transform" }, React.createElement(Upload, { className: "w-8 h-8 text-zinc-400 group-hover:text-white transition-colors" })),
                        React.createElement('div', { className: "text-zinc-400 group-hover:text-zinc-200" }, React.createElement('span', { className: "font-medium" }, "Click to upload"), " or drag and drop"),
                        React.createElement('p', { className: "text-xs text-zinc-500" }, "JPG, PNG up to 10MB")
                    ),
                    React.createElement('input', { type: "file", ref: fileInputRef, className: "hidden", accept: "image/*", onChange: handleFileUpload })
                )
            )
        );

        const renderGenerating = () => React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-8" },
            React.createElement('div', { className: "flex flex-col items-center gap-6 max-w-md text-center" },
                React.createElement(Spinner, { className: "w-12 h-12 text-white" }),
                React.createElement('div', { className: "space-y-2" },
                    React.createElement('h3', { className: "text-2xl font-bold text-white" }, "Working Magic"),
                    React.createElement('p', { className: "text-zinc-400" }, "Applying ", React.createElement('span', { className: "text-white font-medium" }, selectedSuggestion?.title), ". ", React.createElement('br'), "Creating 4 distinct variations...")
                ),
                React.createElement('div', { className: "w-full bg-zinc-800 h-1.5 rounded-full overflow-hidden mt-4" }, React.createElement('div', { className: "h-full bg-white w-1/2 animate-[shimmer_1.5s_infinite_linear]" }))
            )
        );

        const renderResults = () => React.createElement('div', { className: "flex-1 flex flex-col p-6 lg:p-8 overflow-y-auto" },
            React.createElement('div', { className: "max-w-7xl mx-auto w-full space-y-8" },
                React.createElement('div', { className: "flex items-center justify-between" },
                    React.createElement('div', null,
                        React.createElement('h2', { className: "text-2xl font-bold text-white" }, "Select Your Favorite"),
                        React.createElement('p', { className: "text-zinc-400" }, "Click on a variation to refine or save it.")
                    ),
                    React.createElement('button', { onClick: handleReset, className: "px-4 py-2 rounded-lg bg-zinc-800 text-zinc-300 hover:bg-zinc-700 hover:text-white transition text-sm font-medium" }, "Start Over")
                ),
                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-8" },
                    results.map((img, idx) => React.createElement('div', { key: img.id, onClick: () => handleImageSelect(img), className: "group relative bg-zinc-900 rounded-2xl overflow-hidden border border-zinc-800 shadow-lg cursor-pointer hover:border-zinc-500 transition-all duration-300" },
                        React.createElement('div', { className: "h-96 w-full bg-zinc-950 relative flex items-center justify-center p-4" },
                            React.createElement('div', { className: "absolute inset-0 pattern-grid opacity-5" }),
                            React.createElement('img', { src: `data:image/png;base64,${img.data}`, alt: `Result ${idx}`, className: "max-w-full max-h-full object-contain shadow-xl" }),
                            React.createElement('div', { className: "absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center" },
                                React.createElement('div', { className: "bg-white text-black px-6 py-3 rounded-full font-bold flex items-center gap-2 transform translate-y-4 group-hover:translate-y-0 transition-all duration-300 shadow-2xl" }, "Select Variation ", React.createElement(ArrowRight, { className: "w-4 h-4" }))
                            )
                        ),
                        React.createElement('div', { className: "p-4 flex items-center justify-between border-t border-zinc-800 bg-zinc-900" }, React.createElement('span', { className: "text-sm font-medium text-zinc-400 flex items-center gap-2" }, React.createElement(Aperture, { className: "w-4 h-4" }), ` Variation #${idx + 1}`))
                    ))
                )
            )
        );

        const renderMasking = () => React.createElement('div', { className: "flex-1 flex flex-col h-[calc(100vh-80px)] bg-zinc-950" },
            React.createElement('div', { className: "h-16 border-b border-zinc-800 px-8 flex items-center justify-between bg-zinc-900" },
                React.createElement('button', { onClick: () => setStep(AppStep.UPLOAD), className: "flex items-center gap-2 text-zinc-400 hover:text-white" }, React.createElement(ArrowLeft, { className: "w-4 h-4" }), " Back"),
                React.createElement('h2', { className: "text-white font-medium" }, "Paint over the object to replace"),
                React.createElement('button', { onClick: generateMaskAndProceed, className: "px-4 py-2 bg-white text-black rounded-full text-sm font-bold hover:bg-zinc-200 transition-colors" }, "Next: Choose Object")
            ),
            React.createElement('div', { className: "flex-1 relative flex items-center justify-center bg-zinc-950 overflow-hidden touch-none cursor-crosshair" },
                React.createElement('div', { className: "relative shadow-2xl" },
                    React.createElement('canvas', { ref: backgroundCanvasRef, className: "max-h-[75vh] max-w-full object-contain pointer-events-none" }),
                    React.createElement('canvas', { ref: drawCanvasRef, className: "absolute inset-0 w-full h-full touch-none", onMouseDown: startDrawing, onMouseMove: drawOnLayer, onMouseUp: stopDrawing, onMouseLeave: stopDrawing, onTouchStart: startDrawing, onTouchMove: drawOnLayer, onTouchEnd: stopDrawing })
                )
            ),
            React.createElement('div', { className: "h-20 bg-zinc-900 border-t border-zinc-800 flex items-center justify-center gap-8" },
                React.createElement('div', { className: "flex items-center gap-4" },
                    React.createElement('span', { className: "text-xs text-zinc-500 uppercase font-medium tracking-wider" }, "Brush Size"),
                    React.createElement('input', { type: "range", min: "5", max: "100", value: brushSize, onChange: (e) => setBrushSize(Number(e.target.value)), className: "w-32 h-2 bg-zinc-700 rounded-lg appearance-none cursor-pointer accent-white" })
                ),
                React.createElement('button', { onClick: initMasking, className: "flex items-center gap-2 px-4 py-2 rounded-lg bg-zinc-800 text-zinc-300 hover:text-white hover:bg-zinc-700" }, React.createElement(Eraser, { className: "w-4 h-4" }), " Clear Mask")
            )
        );

        const renderReplaceOptions = () => {
          const studioOptions = ["Vintage Film Camera", "Glass Vase with Lilies", "Antique Wooden Stool", "Professional Studio Softbox", "Abstract Marble Sculpture", "Pile of Old Books"];
          return React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-8 animate-fade-in" },
            React.createElement('div', { className: "max-w-2xl w-full space-y-8" },
              React.createElement('div', { className: "text-center space-y-2" },
                React.createElement('h2', { className: "text-3xl font-bold text-white" }, "What should go there?"),
                React.createElement('p', { className: "text-zinc-400" }, "Select a studio prop or describe your own object.")
              ),
              React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-3 gap-4" },
                studioOptions.map((opt) => React.createElement('button', { key: opt, onClick: () => executeReplacement(opt), className: "p-4 bg-zinc-900 border border-zinc-800 rounded-xl text-zinc-300 hover:text-white hover:border-zinc-600 hover:bg-zinc-800 transition-all text-sm font-medium" }, opt))
              ),
              React.createElement('div', { className: "relative" },
                React.createElement('div', { className: "absolute inset-0 flex items-center" }, React.createElement('div', { className: "w-full border-t border-zinc-800" })),
                React.createElement('div', { className: "relative flex justify-center text-sm" }, React.createElement('span', { className: "px-2 bg-zinc-950 text-zinc-500" }, "or describe it"))
              ),
              React.createElement('div', { className: "flex gap-2" },
                React.createElement('input', { type: "text", value: customReplacePrompt, onChange: (e) => setCustomReplacePrompt(e.target.value), placeholder: "e.g. A futuristic neon helmet...", className: "flex-1 bg-zinc-900 border border-zinc-700 text-white px-4 py-3 rounded-xl focus:outline-none focus:border-white focus:ring-1 focus:ring-white placeholder-zinc-600", onKeyDown: (e) => e.key === 'Enter' && customReplacePrompt && executeReplacement(customReplacePrompt) }),
                React.createElement('button', { onClick: () => customReplacePrompt && executeReplacement(customReplacePrompt), disabled: !customReplacePrompt, className: "px-6 bg-white text-black font-bold rounded-xl hover:bg-zinc-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors" }, "Generate")
              ),
              React.createElement('button', { onClick: () => setStep(AppStep.MASKING), className: "w-full text-zinc-500 text-sm hover:text-zinc-300" }, "Cancel and re-mask")
            )
          );
        };
        
        const renderDetailView = () => React.createElement('div', { className: "flex-1 flex flex-col h-[calc(100vh-80px)]" },
          React.createElement('div', { className: "h-16 border-b border-zinc-800 bg-zinc-900 px-8 flex items-center justify-between" },
            React.createElement('button', { onClick: () => setStep(AppStep.RESULTS), className: "flex items-center gap-2 text-zinc-400 hover:text-white transition-colors" }, React.createElement(ArrowLeft, { className: "w-4 h-4" }), " Back to Variations"),
            React.createElement('div', { className: "text-white font-medium" }, "Editing Selection"),
            React.createElement('div', { className: "w-24" })
          ),
          React.createElement('div', { className: "flex-1 flex flex-col lg:flex-row overflow-hidden" },
            React.createElement('div', { className: "flex-1 bg-zinc-950 flex items-center justify-center p-8 relative" },
              selectedImage && React.createElement('div', { className: "relative max-w-full max-h-full" },
                React.createElement('img', { src: `data:image/png;base64,${selectedImage.data}`, alt: "Selected", className: `max-h-[75vh] w-auto rounded-lg shadow-2xl border border-zinc-800 transition-opacity duration-300 ${isRefining ? 'opacity-50 blur-sm' : 'opacity-100'}` }),
                isRefining && React.createElement('div', { className: "absolute inset-0 flex items-center justify-center z-10" },
                  React.createElement('div', { className: "bg-black/50 backdrop-blur-sm p-6 rounded-2xl flex flex-col items-center gap-4" },
                    React.createElement(Spinner, { className: "w-12 h-12 text-white drop-shadow-lg" }),
                    React.createElement('p', { className: "text-white font-medium" }, "Processing Edit...")
                  )
                )
              )
            ),
            React.createElement('div', { className: "w-full lg:w-96 bg-zinc-900 border-l border-zinc-800 p-8 flex flex-col gap-8 overflow-y-auto" },
              React.createElement('div', null,
                React.createElement('h2', { className: "text-2xl font-bold text-white mb-2" }, "Final Touches"),
                React.createElement('p', { className: "text-zinc-400" }, "Refine your selected photo or save it now.")
              ),
              React.createElement('div', { className: "space-y-4" },
                React.createElement('button', { onClick: () => selectedImage && downloadImage(selectedImage.data), className: "w-full py-4 bg-white text-black rounded-xl font-bold hover:bg-zinc-200 transition-colors flex items-center justify-center gap-2", disabled: isRefining }, React.createElement(Download, { className: "w-5 h-5" }), " Save Image"),
                React.createElement('div', { className: "h-px bg-zinc-800 my-4" }),
                React.createElement('h3', { className: "text-sm font-medium text-zinc-500 uppercase tracking-wider" }, "Editing Tools"),
                React.createElement('button', { onClick: handleRemoveSubject, disabled: isRefining, className: "w-full py-4 bg-zinc-800 text-zinc-200 rounded-xl font-medium hover:bg-zinc-700 transition-colors flex items-center justify-center gap-2 border border-zinc-700 hover:border-zinc-600 disabled:opacity-50" }, React.createElement(UserX, { className: "w-5 h-5" }), " Remove Subject"),
                React.createElement('p', { className: "text-xs text-zinc-500 text-center" }, "Remove subject keeps the background.")
              )
            )
          )
        );

        return React.createElement('div', { className: "min-h-screen bg-zinc-950 text-zinc-200 flex flex-col" },
          renderHeader(),
          React.createElement('main', { className: "flex-1 flex flex-col relative" },
            error && React.createElement('div', { className: "absolute top-4 left-1/2 -translate-x-1/2 z-50 bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-2 rounded-full text-sm flex items-center gap-2 animate-fade-in shadow-xl backdrop-blur-md" }, React.createElement('span', null, "!"), ` ${error}`),
            step === AppStep.HOME && renderHome(),
            step === AppStep.WORKFLOW_SELECT && renderWorkflowSelect(),
            step === AppStep.UPLOAD && renderUpload(),
            step === AppStep.GENERATING && renderGenerating(),
            step === AppStep.RESULTS && renderResults(),
            step === AppStep.DETAIL_VIEW && renderDetailView(),
            step === AppStep.MASKING && renderMasking(),
            step === AppStep.REPLACE_OPTIONS && renderReplaceOptions()
          ),
          React.createElement('style', null, `
            @keyframes spin-reverse { from { transform: rotate(360deg); } to { transform: rotate(0deg); } }
            .animate-spin-reverse { animation: spin-reverse 3s linear infinite; }
            @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(200%); } }
            .pattern-grid { background-image: radial-gradient(#3f3f46 1px, transparent 1px); background-size: 20px 20px; }
          `)
        );
      };

      // --- Init ---
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }
      const root = ReactDOM.createRoot(rootElement);
      root.render(React.createElement(React.StrictMode, null, React.createElement(App)));
    </script>
  </body>
</html>